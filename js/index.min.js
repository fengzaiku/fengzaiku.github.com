function Sprite(t){this.oImg=t,this.sx=0,this.sy=0,this.w=0,this.h=0,this.x=0,this.y=0,this.speed=0,this.rotate=0}function d2a(t){return t*Math.PI/180}function a2d(t){return 180*t/Math.PI}function rnd(t,i){return Math.floor(Math.random()*(i-t)+t)}function loadImg(t,i){var n=0,e=0,h={};for(var o in t){e++;var s=new Image;h[o]=s,s.onload=function(){n++,n==e&&i&&i(h)},s.src=t[o]}}function Fish(t,i){this.type=i,Sprite.call(this,t["fish"+i]);var n=[null,{h:55,w:37},{h:78,w:64},{h:72,w:56},{h:77,w:59},{h:107,w:122}];this.w=n[this.type].w,this.h=n[this.type].h,this.rotate=90,this.count=0}function Cannon(t,i){Sprite.call(this,t["cannon"+i]);var n=[null,{w:74,h:74},{w:74,h:76},{w:74,h:76},{w:74,h:83},{w:74,h:85},{w:74,h:90},{w:74,h:94}];this.w=n[i].w,this.h=n[i].h}function Bullet(t,i){Sprite.call(this,t),this.type=i;var n=[null,{x:86,y:0,w:24,h:26},{x:62,y:0,w:25,h:29},{x:30,y:0,w:31,h:35},{x:32,y:35,w:27,h:31},{x:30,y:82,w:29,h:33},{x:0,y:82,w:30,h:34},{x:0,y:0,w:30,h:44}];this.x=n[i].x,this.y=n[i].y,this.w=n[i].w,this.h=n[i].h}function DieFish(t,i){this.type=i,Sprite.call(this,t["fish"+i]);var n=[null,{h:55,w:37},{h:78,w:64},{h:72,w:56},{h:77,w:59},{h:107,w:122}];this.w=n[i].w,this.h=n[i].h,this.sx=4*n[i].w,this.rotate=90,this.count=0}function Web(t,i){this.type=i,this.oImg=t,Sprite.call(this,t);var n=[null,{x:333,y:373,w:88,h:88},{x:180,y:370,w:125,h:125},{x:0,y:415,w:130,h:108},{x:0,y:35,w:246,h:152},{x:257,y:195,w:144,h:148},{x:243,y:0,w:180,h:180},{x:20,y:22,w:203,h:200}];this.scale=.5,this.sx=n[i].x,this.sy=n[i].y,this.w=n[i].w,this.h=n[i].h}function CoinAni(t,i){i>3?this.type=1:this.type=2,Sprite.call(this,t["coinAni"+this.type]),this.w=60,this.h=60,this.count=0,this.sy=0}function $(t){document.addEventListener?document.addEventListener("DOMContentLoaded",function(){t&&t()},!1):document.onreadystatechange=function(){"complete"==document.readyState&&t&&t()}}Sprite.prototype.draw=function(t){t.save(),t.translate(this.x,this.y),t.rotate(d2a(this.rotate)),this.rotate>=-270&&this.rotate<=-90&&t.scale(-1,1),t.drawImage(this.oImg,this.sx,this.sy,this.w,this.h,-this.w/2,-this.h/2,this.w,this.h),t.restore()},Sprite.prototype.move=function(){var t=Math.cos(d2a(this.rotate-90))*this.speed,i=Math.sin(d2a(this.rotate-90))*this.speed;this.x+=t,this.y+=i},Sprite.prototype.collText=function(t){var i=Math.min(this.w/2,this.h/2),n=Math.min(t.w/2,t.h/2),e=this.x-t.x,h=this.y-t.y;return Math.sqrt(e*e+h*h)<(i+n)/2},Fish.prototype=new Sprite,Fish.prototype.constructor=Fish;var oldMove=Sprite.prototype.move;Fish.prototype.move=function(){oldMove.call(this),this.count%4==0&&(this.sx+=this.w,this.sx==4*this.w&&(this.sx=0)),this.count++},Cannon.prototype=new Sprite,Cannon.prototype.constructor=Cannon,Bullet.prototype=new Sprite,Bullet.prototype.constructor=Bullet;var oldMove=Sprite.prototype.move;Bullet.prototype.move=function(){oldMove.call(this),this.speed=20},DieFish.prototype=new Sprite,DieFish.prototype.constructor=DieFish;var oldMove=Sprite.prototype.move;DieFish.prototype.move=function(){oldMove.call(this),this.count%4==0&&(this.sx+=this.w,this.sx>=8*this.w&&(this.sx=4*this.w)),this.count++},Web.prototype=new Sprite,Web.prototype.constructor=Web,Web.prototype.draw=function(t){t.save(),t.translate(this.x,this.y),t.scale(this.scale,this.scale),t.drawImage(this.oImg,this.sx,this.sy,this.w,this.h,-this.w/2,-this.h/2,this.w,this.h),t.restore()},CoinAni.prototype=new Sprite,CoinAni.prototype.constructor=CoinAni;var olDmove=Sprite.move;CoinAni.prototype.move=function(){oldMove.call(this),this.count++,this.sy+=this.h,this.count%4==0&&(this.x+=(20-this.x)/20,this.y+=(oC.height-this.y)/20),this.sy>=9*this.h&&(this.sy=0)},$(function(){var t=document.querySelector("#oC"),i=t.getContext("2d");loadImg({fish1:"img/fish1.png",fish2:"img/fish2.png",fish3:"img/fish3.png",fish4:"img/fish4.png",fish5:"img/fish5.png",cannon1:"img/cannon1.png",cannon2:"img/cannon2.png",cannon3:"img/cannon3.png",cannon4:"img/cannon4.png",cannon5:"img/cannon5.png",cannon6:"img/cannon6.png",cannon7:"img/cannon7.png",bullet:"img/bullet.png",bottom:"img/bottom.png",coinAni1:"img/coinAni1.png",coinAni2:"img/coinAni2.png",coinText:"img/coinText.png",web:"img/web.png"},function(n){var e=[];setInterval(function(){var i=new Fish(n,rnd(1,6));i.rotate=90,rnd(-1,1)<0?(i.x=-100,i.rotate=rnd(70,160)):(i.x=t.width+50,i.rotate=rnd(-160,-70)),i.y=rnd(-100,t.height/2),i.speed=2,e.push(i)},300);var h=1;document.onkeydown=function(t){switch(console.log(t.keyCode),t.keyCode){case 38:h++,h>=8&&(h=1);break;case 40:h--,h<=0&&(h=7)}};var o=new Sprite(n.bottom);o.w=764,o.h=70,o.x=o.w/2,o.y=t.offsetTop+t.height-o.h/2;var s=new Cannon(n,h);s.x=t.width/2+25,s.y=o.y,t.onmousemove=function(i){var n=i.clientX-(s.x+t.offsetLeft);i.clientY>s.y-200&&(i.clientY=s.y-200);var e=s.y-i.clientY,h=90-a2d(Math.atan2(e,n));s.rotate=h};var r=[],a=null;t.onclick=function(){var t=new Audio;t.src="MP3/cannon.mp3",t.play(),clearInterval(a);var i=new Bullet(n.bullet,h);i.x=s.x,i.y=s.y,i.rotate=s.rotate,r.push(i),a=setInterval(function(){s.sy+=s.h,s.sy>=4*s.h&&(clearInterval(a),s.sy=0)},16)};var c=[],p=[],l=[];setInterval(function(){i.clearRect(0,0,t.width,t.height);for(var h=0;h<e.length;h++)e[h].draw(i),e[h].move(),(e[h].x<-100||e[h].x>t.width+100||e[h].h<0||e[h].h>t.height)&&e.splice(h--,1);o.draw(i),s.draw(i);for(var h=0;h<r.length;h++)r[h].draw(i),r[h].move(),(r[h].x<-10||r[h].x>t.width+10||r[h].h<0||r[h].h>t.height)&&r.splice(h--,1);for(var h=0;h<e.length;h++)for(j=0;j<r.length;j++)if(e[h].collText(r[j])){var a=e[h].x,w=e[h].y,y=e[h].type,u=e[h].rotate;e.splice(h--,1),r.splice(j--,1);var v=new DieFish(n,y);v.x=a,v.y=w,v.rotate=u,c.push(v);var d=new Web(n.web,y);d.x=a,d.y=w,d.type=y,p.push(d);var f=new CoinAni(n,y);f.x=a,f.y=w,f.type=y,l.push(f);var g=new Audio;g.src="MP3/coin.wav",g.play()}for(var h=0;h<c.length;h++)c[h].draw(i),c[h].move(),function(t){setTimeout(function(){c.splice(t,1)},500)}(h);for(var h=0;h<p.length;h++)p[h].draw(i),p[h].scale+=.1,p[h].scale>=1.2&&(p.scale=1,p.splice(h--,1));for(var h=0;h<l.length;h++)l[h].draw(i),l[h].move(),Math.floor(l[h].x)>=19&&Math.floor(l[h].y)>=t.height-80&&l.splice(h,1)},30)})});